#! /bin/bash

read -p "Email: " EMAIL

if [[ -z "$EMAIL" ]]; then
  echo "Error: email cannot be empty." >&2
  exit 1
fi

# setup ssh
if ! [ -f ~/.ssh/id_rsa ]; then
  read -p "Do you want to create ssh key? (yes/no) " yn

  case $yn in
    yes ) ssh-keygen -t rsa -b 4096 -C "$EMAIL";;
    no ) echo "exiting...";
      exit;;
    * ) echo "invalid response";
      exit 1;;
  esac
fi

sudo apt update
sudo apt install zsh git jq tree wget curl telnet ack watch colordiff fzf ripgrep socat bison automake libtool openssl flex ctags tmux ruby
# sudo apt upgrade

# install oh-my-zsh
sh -c "$(curl -fsSL https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh | sed 's/exec zsh -l//g')"

# install asdf
git clone https://github.com/asdf-vm/asdf.git ~/.asdf --branch v0.14.1
. ~/.asdf/asdf.sh

# install powerlevel10k theme
git clone --depth=1 https://github.com/romkatv/powerlevel10k.git ~/powerlevel10k
git clone --depth=1 https://github.com/powerline/fonts.git ~/powerlevel10k/fonts
~/powerlevel10k/fonts/install.sh

# vim & tmux
rm -rf ~/maximum-awesome && git clone https://github.com/yangou/maximum-awesome-linux.git ~/maximum-awesome && cd ~/maximum-awesome/ && rake
cd -

line="source $PWD/vim/.vimrc.bundles.local"
grep -qF -- "$line" ~/.vimrc.bundles.local 2>/dev/null || echo "$line" >> ~/.vimrc.bundles.local

line="source $PWD/vim/.vimrc.local"
grep -qF -- "$line" ~/.vimrc.local 2>/dev/null || echo "$line" >> ~/.vimrc.local

vim +PluginInstall +qall

# configure tmux
git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm
line="source $PWD/tmux/.tmux.conf.local"
grep -qF -- "$line" ~/.tmux.conf.local 2>/dev/null || echo "$line" >> ~/.tmux.conf.local

# configure git
git config --global alias.co checkout
git config --global alias.br branch
git config --global alias.cp cherry-pick
git config --global alias.cm commit
git config --global alias.df diff
git config --global alias.st status
git config --global user.name "$USER"
git config --global user.email "$EMAIL"

# install asdf plugins
asdf plugin-add golang
asdf plugin-add java
asdf plugin-add erlang
asdf plugin-add elixir
asdf plugin-add ruby
asdf plugin-add python
asdf plugin-add rebar
asdf plugin-add nodejs
asdf plugin-add rust

# install java
asdf install java openjdk-23.0.1
asdf global java openjdk-23.0.1

# install golang
asdf install golang 1.19
asdf global golang 1.19

# enable gobin
cat $pwd/golang/set-env.zsh > ~/.asdf/plugins/golang/set-env.zsh

line="source $PWD/zsh/.zprofile"
grep -qF -- "$line" ~/.zprofile 2>/dev/null || echo "$line" >> ~/.zprofile

line="source $PWD/zsh/.zshrc"
grep -qF -- "$line" ~/.zshrc 2>/dev/null || echo "$line" >> ~/.zshrc
